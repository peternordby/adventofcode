import math

input = '''[[2,[[4,8],7]],[[9,7],[[2,0],9]]]
[0,[7,5]]
[[[5,[6,9]],4],[3,3]]
[[[6,[6,9]],4],[[[4,8],8],[6,5]]]
[[[[1,4],[2,1]],[6,0]],[[[9,1],[4,2]],[[0,4],0]]]
[[9,4],[[8,6],1]]
[[[[0,7],0],7],[1,[2,9]]]
[[[2,9],[[8,4],[4,0]]],[[[6,2],2],[9,5]]]
[[[0,[5,8]],[6,8]],[[[0,7],4],[[2,8],4]]]
[[3,[[4,1],[0,7]]],[[1,[5,1]],4]]
[[[[2,9],6],[[5,3],2]],[[8,[2,0]],9]]
[0,[[[2,7],9],[1,8]]]
[[[2,[6,2]],[[4,0],[9,6]]],[[6,1],[8,9]]]
[[[[9,6],9],[5,[1,8]]],[[[9,6],9],[[2,0],[3,8]]]]
[[[[4,3],[0,8]],4],[6,6]]
[[[[4,3],7],[[7,0],5]],[2,[[9,9],4]]]
[[[[4,3],[1,7]],[[3,1],[0,9]]],0]
[[5,[[2,5],[2,8]]],[[4,0],[[5,2],[9,8]]]]
[[[0,[3,5]],7],[[[5,9],2],4]]
[[9,[[4,4],8]],[[[2,8],1],[[0,9],5]]]
[[[6,8],[0,1]],[[8,2],[2,0]]]
[[[1,9],[[9,1],2]],[[6,4],[[7,7],[8,3]]]]
[[1,[5,[7,6]]],[[[4,7],4],5]]
[[[8,0],9],[[[6,0],4],1]]
[[[4,[4,2]],7],[[6,[0,9]],[[3,0],[7,6]]]]
[[[[3,4],[9,0]],[4,4]],[[9,6],7]]
[4,[[8,3],[7,1]]]
[6,[6,8]]
[[[[0,6],[7,6]],[5,3]],[[[8,9],[6,0]],[[8,5],7]]]
[[[[0,3],1],5],[[[4,3],[3,2]],[2,[5,9]]]]
[[[[3,1],0],[1,[8,4]]],[4,5]]
[[[0,[4,1]],1],[[1,6],[[4,8],[8,3]]]]
[[[1,4],6],[9,[1,2]]]
[[9,[[0,7],1]],[[0,9],[0,[4,4]]]]
[[1,[7,4]],[[2,[5,3]],[[6,6],9]]]
[0,[0,[0,[0,4]]]]
[[[[9,7],[4,9]],[9,[3,5]]],[[9,7],7]]
[5,[9,[[4,1],[2,9]]]]
[[0,[8,4]],1]
[[[9,[3,3]],[8,6]],[7,[[1,6],0]]]
[[[1,[0,7]],[[9,1],8]],[[[2,2],5],[[7,1],[2,2]]]]
[[[7,[0,3]],4],[[6,[1,6]],[8,7]]]
[[[[4,8],3],[[6,1],7]],[8,[3,[7,8]]]]
[3,[[[9,6],9],3]]
[[[5,[1,0]],[1,4]],5]
[[[[4,7],2],[[7,0],[6,7]]],[[1,[0,3]],0]]
[9,[[3,7],[6,1]]]
[[[2,5],[[0,7],[0,7]]],[[[0,3],2],8]]
[[[[4,4],7],[2,[0,7]]],[[[1,4],[6,6]],[[8,9],[5,2]]]]
[[[[0,8],5],[[3,5],7]],[[[5,6],[0,0]],[[3,8],6]]]
[4,[8,[9,[2,3]]]]
[[[[6,6],9],0],[[[2,9],[0,8]],5]]
[[[8,[4,0]],[[2,1],[7,3]]],[8,7]]
[[6,[9,[1,8]]],[[7,[7,9]],[[2,3],1]]]
[[6,[[1,7],1]],[[[5,3],[2,0]],[[4,4],9]]]
[[[[8,0],[0,3]],[[4,8],[0,9]]],[8,[7,[8,6]]]]
[6,0]
[[[[5,2],0],[3,3]],[0,4]]
[[[9,5],[6,4]],[[[7,2],0],8]]
[[[0,9],[5,[2,3]]],2]
[[[[5,4],[2,9]],[1,[9,0]]],[[9,9],[9,6]]]
[[[7,[4,8]],[9,8]],[[[1,3],0],[4,[4,7]]]]
[[7,[7,9]],0]
[[[[6,7],[8,1]],[[0,2],2]],[[[7,6],6],[[3,4],[9,9]]]]
[[7,[6,[2,2]]],[[[8,8],[0,4]],[5,[7,7]]]]
[[[[0,6],[9,2]],[8,1]],[[[0,4],2],[[5,9],[4,9]]]]
[[[[9,1],[1,7]],[[3,1],[0,7]]],[[2,[4,9]],[9,1]]]
[[[9,4],2],[[[2,3],3],[6,[5,7]]]]
[[[0,8],[[0,9],2]],[[[0,7],[4,4]],7]]
[[[5,2],4],[0,6]]
[[3,[9,[9,2]]],[8,[1,[6,8]]]]
[3,[7,[[8,0],[1,7]]]]
[[[[2,4],[7,3]],[[0,7],0]],5]
[[[[6,0],8],[1,4]],[[[3,3],[8,6]],5]]
[[5,[5,[6,2]]],4]
[[[0,7],[[4,1],4]],[[8,[3,2]],[7,7]]]
[[1,[[6,5],[2,2]]],[[6,[2,8]],[1,0]]]
[6,[4,[[2,2],[1,8]]]]
[[[[3,3],1],[[4,1],7]],[[[5,2],7],[4,[4,7]]]]
[[[[2,2],1],[[4,1],3]],[1,[[0,9],[3,8]]]]
[[0,[0,4]],[[9,[7,5]],[8,[8,0]]]]
[[[[0,3],3],[[7,3],5]],[4,[[0,1],[3,0]]]]
[[4,8],3]
[[[6,0],7],[[6,8],[8,6]]]
[[[[8,5],3],[[6,2],[2,6]]],[[[2,7],5],[[3,8],[6,9]]]]
[7,[4,2]]
[[[[6,0],[7,8]],6],[[[4,6],6],7]]
[[[0,[2,1]],[5,[3,8]]],[[[3,9],3],[[0,9],3]]]
[[[8,6],[4,0]],[2,[[4,1],8]]]
[[[0,1],[[2,0],5]],[[[0,1],[7,0]],[[1,2],[1,4]]]]
[[[8,8],[[4,4],3]],[1,[4,1]]]
[[[5,[0,7]],[7,5]],[[7,6],[5,5]]]
[[[9,[1,3]],[[3,3],6]],[4,[[5,6],8]]]
[[[9,[3,0]],[8,5]],[1,[[8,0],3]]]
[[[3,[3,9]],[[2,4],[4,6]]],[[1,2],3]]
[[[1,[3,1]],[3,[6,3]]],[1,[5,7]]]
[[[[5,5],[1,5]],3],[9,[[7,4],[9,2]]]]
[[[6,[7,1]],[[6,6],[1,6]]],7]
[[[[1,4],0],[8,3]],[[[8,2],9],[[0,3],[9,5]]]]
[[4,[1,[0,1]]],[[1,[7,3]],1]]'''

test = '''[[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]]
[[[5,[2,8]],4],[5,[[9,9],0]]]
[6,[[[6,2],[5,6]],[[7,6],[4,7]]]]
[[[6,[0,7]],[0,9]],[4,[9,[9,0]]]]
[[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]]
[[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]]
[[[[5,4],[7,7]],8],[[8,3],8]]
[[9,3],[[9,9],[6,[4,9]]]]
[[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]]
[[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]'''


def explodeline(line: str, pos):
    comma = line.find(',', pos)
    end = line.find(']', comma)
    left_val = int(line[pos+1:comma])
    right_val = int(line[comma+1:end])
    left = line[:pos]
    left = left[::-1]
    right = line[end+1:]

    num = ''
    for i, char in enumerate(left):
        if char.isnumeric():
            pos = i
            num += char
        elif num:
            break
    if num:
        num = num[::-1]
        pos = pos - len(num) + 1
        middle = str(int(num) + left_val)[::-1]
        left = left[:pos] + middle + left[pos+len(num):]

    num = ''
    for i, char in enumerate(right):
        if char.isnumeric():
            pos = i
            num += char
        elif num:
            break
    if num:
        pos = pos - len(num) + 1
        right = right[:pos] + str(int(num) + right_val) + right[pos+len(num):]
    # print('\nExplode:')
    # print('Before:', line)
    # print('After:', left[::-1] + '0' + right)
    return left[::-1] + '0' + right


def splitline(line, pos, length):
    left = line[:pos]
    right = line[pos+length:]
    middle = '[' + str(math.floor(int(line[pos:pos+length])/2)) + \
        ',' + str(math.ceil(int(line[pos:pos+length])/2)) + ']'
    # print('\nSplitline:')
    # print('Before:', line)
    # print('After:', left + middle + right)
    return left + middle + right


def add(line1, line2):
    return '[' + line1 + ',' + line2 + ']'


def reduce(line):
    # Check explode
    do_explode = False
    stack = []
    for i, char in enumerate(line):
        if char == '[':
            stack.append(char)
        elif char == ']':
            stack.pop()
        if len(stack) == 5:
            do_explode = True
            pos = i
            exploding = line[pos:pos+5]
            break

    if do_explode:
        line = explodeline(line, pos)
        return reduce(line)

    # Check split
    do_splitline = False
    num = ''
    for i, char in enumerate(line):
        if char.isnumeric():
            pos = i
            num += char
        elif num:
            if int(num) >= 10:
                do_splitline = True
                length = len(num)
                break
            num = ''

    if do_splitline:
        line = splitline(line, pos-length+1, length)
        return reduce(line)

    return line


def magnitude(line: str):
    if not line.isnumeric():
        end = line.find(']')
        start = line[:end].rfind('[')
        pair = line[start+1:end]
        left, right = pair.split(',')
        if not left.isnumeric():
            left = magnitude(left)
        if not right.isnumeric():
            right = magnitude(right)
        mag = 3*int(left)+2*int(right)
        line = line[:start] + str(mag) + line[end+1:]
        return magnitude(line)
    else:
        return int(line)


test = '''[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]
[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]
[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]
[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]
[7,[5,[[3,8],[1,4]]]]
[[2,[2,2]],[8,[8,1]]]
[2,9]
[1,[[[9,3],9],[[9,0],[0,7]]]]
[[[5,[7,4]],7],1]
[[[[4,2],2],6],[8,7]]'''

lines = input.split('\n')
line = lines[0]
magnitudes = []
for i in range(len(lines)):
    try:
        line1 = lines[i]
        line2 = lines[i+1]
        addition = add(line1, line2)
    except:
        continue
    line = reduce(addition)
    magnitudes.append(magnitude(line))

print(max(magnitudes))
